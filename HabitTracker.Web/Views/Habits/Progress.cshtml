@model HabitTracker.Web.Models.Habit

@{
    ViewData["Title"] = "Progress";
}

<style>
    .page-title {
        font-family: 'Poppins', sans-serif;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 20px;
    }

    .habit-details p {
        font-family: 'Inter', sans-serif;
        color: #555;
        margin-bottom: 8px;
    }

    .badge {
        font-size: 0.9rem;
        padding: 6px 10px;
        border-radius: 8px;
    }

    .card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .card-title {
        font-family: 'Poppins', sans-serif;
        font-weight: 500;
        color: #34495e;
        margin-bottom: 15px;
    }

    .btn-secondary {
        background-color: #b8c6db;
        color: #2c3e50;
        border: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
    }

        .btn-secondary:hover {
            background-color: #9aa8c0;
            color: white;
        }

    canvas {
        border-radius: 12px;
    }
</style>

<div class="container mt-5">
    <h2 class="page-title">Progress for “@Model.Name”</h2>

    <div class="habit-details mb-4">
        <p><strong>Current Streak:</strong> <span class="badge bg-success">@Model.CurrentStreak days</span></p>
        <p><strong>Description:</strong> @Model.Description</p>
    </div>

    <div class="card p-4">
        <div class="card-body">
            <h4 class="card-title">Last 30 Days Progress</h4>
            <canvas id="progressChart" width="600" height="300"></canvas>
        </div>
    </div>

    <div class="mt-4 text-end">
        <a asp-action="Index" class="btn btn-secondary">Back to Habits</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    (async () => {
        const res = await fetch('/Habits/ProgressData?habitId=@Model.Id');
        const data = await res.json();
        const labels = Object.keys(data);
        const values = Object.values(data);

        new Chart(document.getElementById('progressChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Completed',
                    data: values,
                    backgroundColor: 'rgba(142, 68, 173, 0.4)',
                    borderColor: 'rgba(142, 68, 173, 0.8)',
                    borderWidth: 1,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 },
                        max: 1
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            font: { family: 'Inter', size: 12 },
                            color: '#2c3e50'
                        }
                    }
                }
            }
        });
    })();
</script>
